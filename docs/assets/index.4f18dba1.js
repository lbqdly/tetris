var q=Object.defineProperty,V=Object.defineProperties;var J=Object.getOwnPropertyDescriptors;var R=Object.getOwnPropertySymbols;var Q=Object.prototype.hasOwnProperty,U=Object.prototype.propertyIsEnumerable;var $=(n,e,o)=>e in n?q(n,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[e]=o,T=(n,e)=>{for(var o in e||(e={}))Q.call(e,o)&&$(n,o,e[o]);if(R)for(var o of R(e))U.call(e,o)&&$(n,o,e[o]);return n},P=(n,e)=>V(n,J(e));import{o as v,c as y,r as X,n as Y,a as ee,b as te,d as ne,e as k,f as oe,w as se,t as ae,g as B,h as m,i as le,F as N,j as z,H as D,p as ie,k as re,l as M,m as ce}from"./vendor.40497b89.js";const ue=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))f(r);new MutationObserver(r=>{for(const d of r)if(d.type==="childList")for(const _ of d.addedNodes)_.tagName==="LINK"&&_.rel==="modulepreload"&&f(_)}).observe(document,{childList:!0,subtree:!0});function o(r){const d={};return r.integrity&&(d.integrity=r.integrity),r.referrerpolicy&&(d.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?d.credentials="include":r.crossorigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function f(r){if(r.ep)return;r.ep=!0;const d=o(r);fetch(r.href,d)}};ue();var p={SIZE:20,COL:10,ROW:20,EACH_S:2,SPEED:1e3,SPEED_A:8};const b=[{name:"J",state:{"0*0":0,"1*0":0,"2*0":0,"3*0":0,"0*1":1,"1*1":0,"2*1":0,"3*1":0,"0*2":1,"1*2":1,"2*2":1,"3*2":0,"0*3":0,"1*3":0,"2*3":0,"3*3":0}},{name:"L",state:{"0*0":0,"1*0":0,"2*0":0,"3*0":0,"0*1":0,"1*1":0,"2*1":1,"3*1":0,"0*2":1,"1*2":1,"2*2":1,"3*2":0,"0*3":0,"1*3":0,"2*3":0,"3*3":0}},{name:"Z",state:{"0*0":0,"1*0":0,"2*0":0,"3*0":0,"0*1":1,"1*1":1,"2*1":0,"3*1":0,"0*2":0,"1*2":1,"2*2":1,"3*2":0,"0*3":0,"1*3":0,"2*3":0,"3*3":0}},{name:"S",state:{"0*0":0,"1*0":0,"2*0":0,"3*0":0,"0*1":0,"1*1":0,"2*1":1,"3*1":1,"0*2":0,"1*2":1,"2*2":1,"3*2":0,"0*3":0,"1*3":0,"2*3":0,"3*3":0}},{name:"O",state:{"0*0":0,"1*0":0,"2*0":0,"3*0":0,"0*1":0,"1*1":1,"2*1":1,"3*1":0,"0*2":0,"1*2":1,"2*2":1,"3*2":0,"0*3":0,"1*3":0,"2*3":0,"3*3":0}},{name:"T",state:{"0*0":0,"1*0":0,"2*0":0,"3*0":0,"0*1":0,"1*1":1,"2*1":0,"3*1":0,"0*2":1,"1*2":1,"2*2":1,"3*2":0,"0*3":0,"1*3":0,"2*3":0,"3*3":0}},{name:"I",state:{"0*0":0,"1*0":1,"2*0":0,"3*0":0,"0*1":0,"1*1":1,"2*1":0,"3*1":0,"0*2":0,"1*2":1,"2*2":0,"3*2":0,"0*3":0,"1*3":1,"2*3":0,"3*3":0}}];function fe(){return b.map(n=>n.name)}function de(){const n={};for(let e=0;e<p.ROW;e++)for(let o=0;o<p.COL;o++)n[o+"*"+e]=0;return n}class pe{constructor(e){if(this.x=3,this.y=-3,e&&fe().indexOf(e)>=0)this.state=b.find(o=>o.name===e).state,this.name=e;else{let o=b[Math.floor(b.length*Math.random())];this.state=o.state,this.name=o.name}}}var L=(n,e)=>{for(const[o,f]of e)n[o]=f;return n};const me={props:{value:{type:Number},size:{type:Number,default:10}}};function _e(n,e,o,f,r,d){return v(),y("div",{style:Y({width:`${o.size}px`,height:`${o.size}px`}),class:ee(["g",{color:Boolean(o.value)}])},[X(n.$slots,"default",{},void 0,!0)],6)}var ve=L(me,[["render",_e],["__scopeId","data-v-25f9640c"]]);function G(n){if(n.length<2)return n;n.sort();let e=[n[0]];for(let o=1;o<n.length;o++)n[o]!==e[e.length-1]&&e.push(n[o]);return e}const ye={components:{Block:ve},setup(){const n=[],e=te({speed:p.SPEED,isIng:!1,activeGroup:{},scroe:0,actives:[],stables:[],totalScore:0,roundCount:0,readyGroup:{}}),o=ne(null),f=k(()=>{const t=de();return[...e.actives,...e.stables].forEach(s=>{t[s]=1}),t}),r=k(()=>{const t=[];return Object.keys(f.value).forEach(a=>{const[s,l]=a.split("*");t[l]||(t[l]=[]),t[l][s]=f.value[a]}),t}),d=k(()=>[]);function _(){e.roundCount=0,e.totalScore=0,e.stables=[],e.speed=p.SPEED,E(),S()}function h(){e.isIng=!1}function E(){e.isIng=!0,w()}function S(){for(e.actives=[];n.length<2;)n.push(new pe);e.activeGroup=n.shift(),e.readyGroup=n[0],e.speed>0&&(e.speed-=p.SPEED_A),e.roundCount+=1,e.isIng=!0}function I(t,a=0){let s=G(e.stables),l=[];return Object.keys(t.state).forEach(i=>{let u=c(i,{x:t.x,y:t.y}).key;t.state[i]===1&&((c(u).x<0||c(u).x>p.COL-1)&&l.push(c(i).x),s.forEach(C=>{u===C&&l.push(c(i).x)}))}),G(l).forEach(i=>{a===0?(i<2&&(console.log("\u4FEE\u590D\u5DE6\u8FB9"),t.x+=1),i>1&&(console.log("\u4FEE\u590D\u53F3\u8FB9"),t.x-=1)):a===1?i<=2&&(console.log("\u4FEE\u590D\u5DE6\u8FB9"),t.x+=1):a===2&&i>=1&&(console.log("\u4FEE\u590D\u53F3\u8FB9"),t.x-=1)}),t}function w(){x("y",1,!0),e.isIng&&setTimeout(w,e.speed)}function F(){e.isIng=!1,e.stables=W(e.stables.concat(e.actives)),e.actives.some(t=>c(t).y<=0)?(console.log("\u89E6\u9876"),j()):(console.log("\u65B0\u4E00\u8F6E"),S())}function W(t,a){t=G(t);let s=[],l={};for(let i in t){let u=c(t[i]).y;l[u]?(l[u]+=1,l[u]>=p.COL&&s.push(u)):l[u]=1}return e.scroe=Math.pow(p.EACH_S,s.length),e.totalScore+=e.scroe,s.forEach(i=>{t=t.filter(u=>c(u).y!==i),t=t.map(u=>{let C=c(u).x,O=c(u).y;return O<parseInt(i)?(O+=1,C+"*"+O):u})}),t}function j(){console.log("game over !"),alert("game over!"),e.isIng=!1}function x(t="y",a=1,s=!1){if(e.isIng===!1)return;let l=K(e.activeGroup);console.log("gap:",l),t==="y"?l===0&&s?F():a>=l?e.activeGroup.y+=l:e.activeGroup.y+=a:t==="x"?(e.activeGroup.x+=a,e.activeGroup=I(e.activeGroup,a>0?2:1)):t==="o"&&(e.activeGroup.state=H(e.activeGroup.state),e.activeGroup=I(e.activeGroup,0)),e.actives=A(e.activeGroup)}function H(t){let a={"0*0":"3*0","1*0":"3*1","2*0":"3*2","3*0":"3*3","0*1":"2*0","1*1":"2*1","2*1":"2*2","3*1":"2*3","0*2":"1*0","1*2":"1*1","2*2":"1*2","3*2":"1*3","0*3":"0*0","1*3":"0*1","2*3":"0*2","3*3":"0*3"},s={};for(let l in t)s[a[l]]=t[l];return s}function A(t){const a=[];for(let s in t.state)if(t.state[s]>0){let l=parseInt(s.split("*")[0]),i=parseInt(s.split("*")[1]);l+=t.x,i+=t.y,a.push(l+"*"+i)}return a}function c(t,a){a=a||{x:0,y:0};let s=parseInt(t.split("*")[0])+a.x,l=parseInt(t.split("*")[1])+a.y;return{x:s,y:l,key:s+"*"+l}}function K(t){const a=A(t);let s=p.ROW,l=G(e.stables);return a.forEach(i=>{p.ROW-c(i).y<s&&(s=p.ROW-c(i).y),l.forEach(u=>{c(i).x===c(u).x&&c(u).y>c(i).y&&c(u).y-c(i).y<s&&(s=c(u).y-c(i).y)})}),s-1}function Z(){let t=0,a=new D(o.value);a.get("pan").set({direction:D.DIRECTION_ALL}),a.on("tap panleft panright pandown",s=>{if(s.type==="tap"){x("o");return}s.timeStamp-t<150||(s.additionalEvent==="panright"?x("x"):s.additionalEvent==="panleft"?x("x",-1):s.additionalEvent==="pandown"&&x("y"),t=s.timeStamp)}),a.get("swipe").set({direction:D.DIRECTION_VERTICAL}),a.on("swipedown",s=>{x("y",p.ROW,!0)})}return oe(()=>{console.log(o),Z(),_()}),se(()=>{console.log("isIng:",e.isIng),console.log("speed:",e.speed),console.log("roundCount:",e.roundCount)}),P(T({},ae(e)),{stageData:f,refStage:o,stageDataForDom:r,nextDataForDom:d,config:p,gamePause:h,gameContinue:E,gameReplay:_})}},g=n=>(ie("data-v-5d7136dc"),n=n(),re(),n),ge={class:"game"},he={class:"panel"},xe=g(()=>m("div",null,null,-1)),Ee=g(()=>m("i",{class:"divide"},null,-1)),Se=g(()=>m("b",null,null,-1)),Ie=g(()=>m("div",null,"\u5386\u53F2\u6700\u4F73\uFF1A",-1)),be=g(()=>m("b",null,null,-1)),Ge=g(()=>m("i",{class:"divide"},null,-1)),Ce=g(()=>m("div",{class:"btn-gap"},null,-1)),Oe={ref:"refStage",class:"stage"};function ke(n,e,o,f,r,d){const _=B("Block");return v(),y("div",ge,[m("div",he,[xe,Ee,m("div",null,"\u5F97\u5206\uFF1A"+le(n.totalScore),1),Se,Ie,be,Ge,n.isIng?(v(),y("button",{key:0,onClick:e[0]||(e[0]=h=>f.gamePause())},"\u6682\u505C")):(v(),y("button",{key:1,onClick:e[1]||(e[1]=h=>f.gameContinue())},"\u7EE7\u7EED")),Ce,m("button",{onClick:e[2]||(e[2]=h=>f.gameReplay())},"\u91CD\u65B0\u5F00\u59CB")]),m("div",Oe,[(v(!0),y(N,null,z(f.stageDataForDom,(h,E)=>(v(),y("div",{class:"row",key:E},[(v(!0),y(N,null,z(h,(S,I)=>(v(),M(_,{key:I,size:f.config.SIZE,value:S},null,8,["size","value"]))),128))]))),128))],512)])}var De=L(ye,[["render",ke],["__scopeId","data-v-5d7136dc"]]);const Le={components:{TetrisGame:De}};function we(n,e,o,f,r,d){const _=B("TetrisGame");return v(),M(_)}var Ae=L(Le,[["render",we]]);ce(Ae).mount("#app");
